/**
 * Markdown Docs Base Styles
 *
 * Minimal, themeable base styles using CSS variables
 * Designed to work standalone or integrate with existing design systems
 */

:root {
  // ============================================================================
  // Surfaces
  // ============================================================================

  --md-surface-base: rgba(255, 255, 255, 0.03);
  --md-surface-raised: rgba(255, 255, 255, 0.06);
  --md-surface-elevated: rgba(255, 255, 255, 0.09);
  --md-surface-overlay: rgba(255, 255, 255, 0.1);

  // ============================================================================
  // Borders
  // ============================================================================

  --md-border-subtle: rgba(255, 255, 255, 0.06);
  --md-border-medium: rgba(255, 255, 255, 0.12);
  --md-border-strong: rgba(255, 255, 255, 0.24);

  // ============================================================================
  // Text
  // ============================================================================

  --md-text-primary: rgba(255, 255, 255, 0.95);
  --md-text-secondary: rgba(255, 255, 255, 0.7);
  --md-text-tertiary: rgba(255, 255, 255, 0.5);
  --md-text-accent: rgb(0, 122, 255);

  // ============================================================================
  // Spacing
  // ============================================================================

  --md-spacing-xs: 0.25rem;    // 4px
  --md-spacing-sm: 0.5rem;     // 8px
  --md-spacing-md: 1rem;       // 16px
  --md-spacing-lg: 1.5rem;     // 24px
  --md-spacing-xl: 2rem;       // 32px
  --md-spacing-2xl: 3rem;      // 48px

  // ============================================================================
  // Typography
  // ============================================================================

  --md-font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
  --md-font-system: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  --md-font-size-xs: 0.75rem;    // 12px
  --md-font-size-sm: 0.875rem;   // 14px
  --md-font-size-base: 1rem;     // 16px
  --md-font-size-lg: 1.125rem;   // 18px
  --md-font-size-xl: 1.25rem;    // 20px
  --md-font-size-2xl: 1.5rem;    // 24px
  --md-font-size-3xl: 1.875rem;  // 30px

  --md-line-height-tight: 1.25;
  --md-line-height-normal: 1.5;
  --md-line-height-relaxed: 1.625;

  // ============================================================================
  // Border Radius
  // ============================================================================

  --md-radius-sm: 6px;
  --md-radius-md: 10px;
  --md-radius-lg: 14px;
  --md-radius-xl: 18px;
  --md-radius-full: 9999px;

  // ============================================================================
  // Transitions
  // ============================================================================

  --md-duration-instant: 100ms;
  --md-duration-fast: 200ms;
  --md-duration-normal: 300ms;
  --md-duration-slow: 400ms;

  --md-ease-out: cubic-bezier(0.33, 1, 0.68, 1);
  --md-ease-in-out: cubic-bezier(0.65, 0, 0.35, 1);

  // ============================================================================
  // Shadows
  // ============================================================================

  --md-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
  --md-shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
  --md-shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.4);

  // ============================================================================
  // Callout Colors
  // ============================================================================

  --md-callout-blue-bg: rgba(0, 122, 255, 0.1);
  --md-callout-blue-border: rgb(0, 122, 255);
  --md-callout-blue-text: rgb(100, 181, 246);

  --md-callout-green-bg: rgba(34, 197, 94, 0.1);
  --md-callout-green-border: rgb(34, 197, 94);
  --md-callout-green-text: rgb(129, 230, 175);

  --md-callout-purple-bg: rgba(147, 51, 234, 0.1);
  --md-callout-purple-border: rgb(147, 51, 234);
  --md-callout-purple-text: rgb(186, 135, 255);

  --md-callout-yellow-bg: rgba(251, 191, 36, 0.1);
  --md-callout-yellow-border: rgb(251, 191, 36);
  --md-callout-yellow-text: rgb(253, 224, 71);

  --md-callout-red-bg: rgba(239, 68, 68, 0.1);
  --md-callout-red-border: rgb(239, 68, 68);
  --md-callout-red-text: rgb(252, 165, 165);

  --md-callout-success-bg: rgba(34, 197, 94, 0.1);
  --md-callout-success-border: rgb(34, 197, 94);
  --md-callout-success-text: rgb(134, 239, 172);

  --md-callout-danger-bg: rgba(220, 38, 38, 0.1);
  --md-callout-danger-border: rgb(220, 38, 38);
  --md-callout-danger-text: rgb(248, 113, 113);

  --md-callout-info-bg: rgba(59, 130, 246, 0.1);
  --md-callout-info-border: rgb(59, 130, 246);
  --md-callout-info-text: rgb(147, 197, 253);

  --md-callout-question-bg: rgba(168, 85, 247, 0.1);
  --md-callout-question-border: rgb(168, 85, 247);
  --md-callout-question-text: rgb(196, 181, 253);
}

// ============================================================================
// Utility Classes
// ============================================================================

.md-surface {
  background: var(--md-surface-base);
  border: 1px solid var(--md-border-subtle);
  border-radius: var(--md-radius-md);
}

.md-surface--raised {
  background: var(--md-surface-raised);
  border-color: var(--md-border-medium);
}

.md-surface--elevated {
  background: var(--md-surface-elevated);
  border-color: var(--md-border-medium);
  box-shadow: var(--md-shadow-md);
}

// ============================================================================
// Callout Styles
// ============================================================================

.md-callout {
  display: flex;
  flex-direction: column;
  gap: var(--md-spacing-sm);
  padding: var(--md-spacing-lg);
  border-radius: var(--md-radius-lg);
  margin: var(--md-spacing-xl) 0;
  border-left: 4px solid;
  transition: transform var(--md-duration-fast) var(--md-ease-out);

  // Subtle hover effect for interactive feel
  &:hover {
    transform: translateX(2px);
  }
}

.md-callout__header {
  display: flex;
  align-items: center;
  gap: var(--md-spacing-sm);
  font-weight: 600;
  font-size: var(--md-font-size-sm);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.md-callout__icon {
  display: inline-flex;
  font-size: var(--md-font-size-lg);
  line-height: 1;
}

.md-callout__label {
  flex: 1;
}

.md-callout__content {
  font-size: var(--md-font-size-base);
  line-height: var(--md-line-height-relaxed);

  // Reset margins for first and last elements
  > :first-child {
    margin-top: 0;
  }

  > :last-child {
    margin-bottom: 0;
  }

  // Style nested elements
  p {
    margin: var(--md-spacing-sm) 0;
  }

  ul, ol {
    margin: var(--md-spacing-sm) 0;
    padding-left: var(--md-spacing-lg);
  }

  li {
    margin: var(--md-spacing-xs) 0;
  }

  code {
    background: var(--md-surface-elevated);
    padding: 0.125rem 0.375rem;
    border-radius: var(--md-radius-sm);
    font-size: 0.875em;
    font-family: var(--md-font-mono);
  }

  pre {
    background: var(--md-surface-elevated);
    padding: var(--md-spacing-md);
    border-radius: var(--md-radius-md);
    overflow-x: auto;
    margin: var(--md-spacing-md) 0;

    code {
      background: none;
      padding: 0;
    }
  }

  a {
    color: var(--md-text-accent);
    text-decoration: none;
    transition: opacity var(--md-duration-fast) var(--md-ease-out);

    &:hover {
      opacity: 0.8;
      text-decoration: underline;
    }
  }
}

// Callout color variants
.md-callout--blue {
  background: var(--md-callout-blue-bg);
  border-left-color: var(--md-callout-blue-border);

  .md-callout__header {
    color: var(--md-callout-blue-text);
  }
}

.md-callout--green {
  background: var(--md-callout-green-bg);
  border-left-color: var(--md-callout-green-border);

  .md-callout__header {
    color: var(--md-callout-green-text);
  }
}

.md-callout--purple {
  background: var(--md-callout-purple-bg);
  border-left-color: var(--md-callout-purple-border);

  .md-callout__header {
    color: var(--md-callout-purple-text);
  }
}

.md-callout--yellow {
  background: var(--md-callout-yellow-bg);
  border-left-color: var(--md-callout-yellow-border);

  .md-callout__header {
    color: var(--md-callout-yellow-text);
  }
}

.md-callout--red {
  background: var(--md-callout-red-bg);
  border-left-color: var(--md-callout-red-border);

  .md-callout__header {
    color: var(--md-callout-red-text);
  }
}

.md-callout--success {
  background: var(--md-callout-success-bg);
  border-left-color: var(--md-callout-success-border);

  .md-callout__header {
    color: var(--md-callout-success-text);
  }
}

.md-callout--danger {
  background: var(--md-callout-danger-bg);
  border-left-color: var(--md-callout-danger-border);

  .md-callout__header {
    color: var(--md-callout-danger-text);
  }
}

.md-callout--info {
  background: var(--md-callout-info-bg);
  border-left-color: var(--md-callout-info-border);

  .md-callout__header {
    color: var(--md-callout-info-text);
  }
}

.md-callout--question {
  background: var(--md-callout-question-bg);
  border-left-color: var(--md-callout-question-border);

  .md-callout__header {
    color: var(--md-callout-question-text);
  }
}

// ============================================================================
// Search Highlight Styles
// ============================================================================

mark {
  background: var(--md-callout-yellow-bg);
  color: var(--md-callout-yellow-text);
  padding: 0.125rem 0.25rem;
  border-radius: var(--md-radius-sm);
  font-weight: 500;
}

// ============================================================================
// Mermaid Diagram Styles
// ============================================================================

.md-mermaid {
  margin: var(--md-spacing-xl) 0;
  padding: var(--md-spacing-lg);
  background: var(--md-surface-base);
  border: 1px solid var(--md-border-subtle);
  border-radius: var(--md-radius-lg);
  overflow-x: auto;

  svg {
    max-width: 100%;
    height: auto;
  }
}

.md-mermaid--rendered {
  display: flex;
  justify-content: center;
  align-items: center;
}

// ============================================================================
// Code Tabs Styles
// ============================================================================

.md-code-tabs {
  margin: var(--md-spacing-xl) 0;
  background: var(--md-surface-base);
  border: 1px solid var(--md-border-medium);
  border-radius: var(--md-radius-lg);
  overflow: hidden;
}

.md-code-tabs__header {
  display: flex;
  gap: var(--md-spacing-xs);
  padding: var(--md-spacing-sm);
  background: var(--md-surface-raised);
  border-bottom: 1px solid var(--md-border-subtle);
  overflow-x: auto;
}

.md-code-tabs__tab {
  padding: var(--md-spacing-sm) var(--md-spacing-lg);
  background: transparent;
  border: 1px solid transparent;
  border-radius: var(--md-radius-md);
  color: var(--md-text-secondary);
  cursor: pointer;
  transition: all var(--md-duration-fast);
}

.md-code-tabs__tab--active {
  background: var(--md-surface-accent, rgba(0, 122, 255, 0.1));
  border-color: var(--md-text-accent);
  color: var(--md-text-primary);
}

.md-code-tabs__content {
  padding: 0;
}

.md-code-tabs__panel {
  display: none;
}

.md-code-tabs__panel--active {
  display: block;
}

// ============================================================================
// File Tree Styles
// ============================================================================

.md-filetree {
  margin: var(--md-spacing-xl) 0;
  padding: var(--md-spacing-lg);
  background: var(--md-surface-base);
  border: 1px solid var(--md-border-subtle);
  border-radius: var(--md-radius-lg);
  font-family: var(--md-font-mono);
  font-size: var(--md-font-size-sm);
  overflow-x: auto;
  line-height: var(--md-line-height-relaxed);
}

.md-filetree__item {
  display: flex;
  flex-direction: column;
}

.md-filetree__row {
  display: flex;
  align-items: center;
  gap: var(--md-spacing-xs);
  padding: var(--md-spacing-xs) var(--md-spacing-sm);
  border-radius: var(--md-radius-sm);
  transition: background var(--md-duration-fast) var(--md-ease-out);
  position: relative;

  &:hover {
    background: var(--md-surface-raised);
  }
}

.md-filetree__toggle {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  padding: 0;
  margin-right: var(--md-spacing-xs);
  background: none;
  border: none;
  color: var(--md-text-tertiary);
  cursor: pointer;
  transition: transform var(--md-duration-fast) var(--md-ease-out);
  font-size: 10px;

  &:hover {
    color: var(--md-text-primary);
  }
}

.md-filetree__toggle--expanded {
  transform: rotate(90deg);
}

.md-filetree__spacer {
  width: 16px;
  flex-shrink: 0;
}

.md-filetree__icon {
  flex-shrink: 0;
  width: 20px;
  text-align: center;
  font-size: var(--md-font-size-base);
}

.md-filetree__name {
  flex: 1;
  text-align: left;
  background: none;
  border: none;
  padding: 0;
  font-family: var(--md-font-mono);
  font-size: var(--md-font-size-sm);
  color: var(--md-text-primary);
  cursor: pointer;
  transition: all var(--md-duration-fast) var(--md-ease-out);
  position: relative;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;

  &:hover:not(:disabled) {
    color: var(--md-text-accent);
    text-decoration: underline;
  }

  &:disabled {
    cursor: default;
  }
}

.md-filetree__name--folder {
  color: #8be9fd; /* cyan */
  font-weight: 600;
}

.md-filetree__name--copied {
  color: var(--md-callout-green-text) !important;
}

.md-filetree__copied {
  margin-left: auto;
  font-size: var(--md-font-size-xs);
  color: var(--md-callout-green-text);
  font-weight: 600;
  animation: fadeIn var(--md-duration-fast) var(--md-ease-out);
}

.md-filetree__github {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  padding: 0;
  background: var(--md-surface-elevated);
  border: 1px solid var(--md-border-medium);
  border-radius: var(--md-radius-sm);
  color: var(--md-text-secondary);
  cursor: pointer;
  transition: all var(--md-duration-fast) var(--md-ease-out);
  font-size: 12px;

  &:hover {
    background: var(--md-surface-overlay);
    border-color: var(--md-border-strong);
    color: var(--md-text-primary);
  }
}

.md-filetree__children {
  margin-left: var(--md-spacing-lg);
  border-left: 1px solid var(--md-border-subtle);
  padding-left: var(--md-spacing-md);
  display: flex;
  flex-direction: column;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

// ============================================================================
// Enhanced Code Block Styles (Proposal 00)
// ============================================================================

/**
 * Code Block Container
 * Wraps code blocks with metadata (title, line numbers)
 */
.code-block-container {
  margin: var(--md-spacing-xl) 0;
  background: var(--md-surface-base);
  border: 1px solid var(--md-border-medium);
  border-radius: var(--md-radius-lg);
  overflow: hidden;

  // Remove margins from nested pre tags
  pre {
    margin: 0;
    border-radius: 0;
    border: none;
  }
}

/**
 * Code Block Title Bar
 * Displays filename above code block
 */
.code-block-title {
  padding: var(--md-spacing-sm) var(--md-spacing-lg);
  background: var(--md-surface-raised);
  border-bottom: 1px solid var(--md-border-subtle);
  color: var(--md-text-secondary);
  font-family: var(--md-font-mono);
  font-size: var(--md-font-size-sm);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: var(--md-spacing-sm);

  // File icon (optional enhancement)
  &::before {
    content: 'ðŸ“„';
    font-size: var(--md-font-size-base);
  }
}

/**
 * Code Block with Line Numbers
 * Container for line numbers + code
 */
.code-block-with-lines {
  display: grid;
  grid-template-columns: auto 1fr;
  background: #282a36; // Dracula theme bg
}

/**
 * Line Numbers Column
 */
.code-block-line-numbers {
  display: flex;
  flex-direction: column;
  padding: var(--md-spacing-lg) var(--md-spacing-sm);
  background: rgba(0, 0, 0, 0.2);
  border-right: 1px solid var(--md-border-subtle);
  user-select: none;
  text-align: right;
  min-width: 3ch;
}

.line-number {
  display: block;
  height: 1.5rem; // Match line height
  color: var(--md-text-tertiary);
  font-family: var(--md-font-mono);
  font-size: var(--md-font-size-sm);
  line-height: 1.5rem;

  &.highlight {
    color: var(--md-text-accent);
    font-weight: 700;
  }
}

/**
 * Line Highlighting
 * Highlight specific lines in code blocks
 */
.shiki .line.highlight {
  background: rgba(255, 255, 255, 0.1);
  border-left: 3px solid var(--md-text-accent, #bd93f9);
  padding-left: calc(var(--md-spacing-md) - 3px);
  margin-left: -var(--md-spacing-md);
  display: inline-block;
  width: calc(100% + var(--md-spacing-md));
}

/**
 * Diff Syntax Support
 * Style added (+) and removed (-) lines
 */
.shiki .line.diff-add {
  background: rgba(34, 197, 94, 0.15); // Green
  border-left: 3px solid rgb(34, 197, 94);
  padding-left: calc(var(--md-spacing-md) - 3px);
  margin-left: -var(--md-spacing-md);
  display: inline-block;
  width: calc(100% + var(--md-spacing-md));

  // Dim the + symbol itself
  &::before {
    content: '+';
    position: absolute;
    left: 0;
    color: rgb(34, 197, 94);
    font-weight: 700;
    opacity: 0.6;
  }
}

.shiki .line.diff-remove {
  background: rgba(239, 68, 68, 0.15); // Red
  border-left: 3px solid rgb(239, 68, 68);
  padding-left: calc(var(--md-spacing-md) - 3px);
  margin-left: -var(--md-spacing-md);
  display: inline-block;
  width: calc(100% + var(--md-spacing-md));
  text-decoration: line-through;
  opacity: 0.8;

  // Dim the - symbol itself
  &::before {
    content: '-';
    position: absolute;
    left: 0;
    color: rgb(239, 68, 68);
    font-weight: 700;
    opacity: 0.6;
  }
}

// ============================================================================
// Responsive Utilities
// ============================================================================

@media (max-width: 768px) {
  .md-callout {
    padding: var(--md-spacing-md);
    margin: var(--md-spacing-lg) 0;
  }

  .md-callout__header {
    font-size: var(--md-font-size-xs);
  }

  .md-callout__content {
    font-size: var(--md-font-size-sm);
  }

  .md-filetree {
    padding: var(--md-spacing-md);
    font-size: var(--md-font-size-xs);
  }

  .md-filetree__children {
    margin-left: var(--md-spacing-md);
    padding-left: var(--md-spacing-sm);
  }
}

// ============================================================================
// KaTeX Math Rendering (Proposal 06)
// ============================================================================

/**
 * KaTeX Math Equations
 * Styles for inline and display math rendered by KaTeX
 */

// Inline math - flows with text
.math-inline {
  display: inline;
  vertical-align: baseline;
}

// Display math - centered block
.math-display {
  display: block;
  margin: var(--md-spacing-lg) 0;
  text-align: center;
  overflow-x: auto;
  overflow-y: hidden;

  // Add padding for mobile scrolling
  padding: var(--md-spacing-sm) 0;
}

// Error styling
.katex-error {
  padding: var(--md-spacing-sm) var(--md-spacing-md);
  background: rgba(204, 0, 0, 0.05);
  border-left: 3px solid #cc0000;
  border-radius: var(--md-radius-sm);
  font-family: var(--md-font-mono);
  font-size: var(--md-font-size-xs);

  strong {
    font-weight: 600;
  }

  code {
    display: block;
    margin-top: var(--md-spacing-xs);
    white-space: pre-wrap;
    word-break: break-word;
  }
}

/**
 * Dark Mode Support for KaTeX
 * Override KaTeX default colors for dark theme
 */
@media (prefers-color-scheme: dark) {
  // Update KaTeX text color for dark mode
  .katex {
    color: var(--md-text-primary, #e5e7eb);
  }

  // Ensure math symbols are visible
  .katex .mord,
  .katex .mop,
  .katex .mbin,
  .katex .mrel,
  .katex .mopen,
  .katex .mclose,
  .katex .mpunct {
    color: var(--md-text-primary, #e5e7eb);
  }

  // Update fraction lines and other rules
  .katex .frac-line,
  .katex .overline-line,
  .katex .underline-line,
  .katex .hline,
  .katex .rule {
    border-color: var(--md-border-medium, #4b5563);
    background-color: var(--md-border-medium, #4b5563);
  }

  // Update radical (square root) lines
  .katex .sqrt > .root {
    border-color: var(--md-text-primary, #e5e7eb);
  }

  // Error styling for dark mode
  .katex-error {
    background: rgba(239, 68, 68, 0.1);
    border-left-color: #ef4444;
    color: #fca5a5;
  }
}

/**
 * Responsive Math Equations
 * Handle long equations on small screens
 */
@media (max-width: 768px) {
  .math-display {
    // Ensure equations can scroll on mobile
    max-width: 100%;
    font-size: 0.9em;
  }

  // Reduce inline math size slightly on mobile
  .math-inline {
    font-size: 0.95em;
  }
}
